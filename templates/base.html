{% load static %} {% load widget_tweaks %}

<!doctype html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <title>StudyHub</title>

    <link href="{% static 'css/style.css' %}" rel="stylesheet" />

    <script src="http://maps.google.com/maps/api/js?key=AIzaSyAuDf-txlL1EEte-Iqolx0CvtvxazFkF6k"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Kosugi+Maru&family=Rampart+One&display=swap"
      rel="stylesheet"
    />
    <script src="{% static 'js/map.js' %}" defer></script>
    <script src="{% static 'js/map-display.js' %}" defer></script>
  </head>

  <body class="h-dvh w-full bg-baseColor">
    <nav id="menubar" class="flex h-20 flex-shrink-0 items-center bg-menuColor">
      <a
        href="#"
        class="pb-2 pl-5 pr-10 font-rampartOne text-4xl text-baseColor"
        >StudyHub</a
      >
      <ul class="flex h-full items-center">
        <li
          class="flex h-full items-center justify-center hover:bg-highlightColor"
        >
          <a href="#" class="px-8 font-kosugiMaru text-2xl text-baseColor"
            >HOME</a
          >
        </li>
        <li
          class="flex h-full items-center justify-center hover:bg-highlightColor"
        >
          <a href="#" class="px-8 font-kosugiMaru text-2xl text-baseColor"
            >検索</a
          >
        </li>
        <li
          class="flex h-full items-center justify-center hover:bg-highlightColor"
        >
          <a
            href="/test/todo"
            class="px-8 font-kosugiMaru text-2xl text-baseColor"
            >ToDo</a
          >
        </li>
        <li>
          <p class="px-8 font-kosugiMaru text-xl font-medium text-baseColor">
            マイペー<span class="text-xs">ジ</span
            ><ion-icon name="hammer-outline" class="scale-x-[-1]"></ion-icon>
          </p>
        </li>
      </ul>
      <form
        method="POST"
        action="{% url 'logout' %}"
        class="ml-auto flex h-full items-center justify-center"
      >
        {% csrf_token %}
        <button
          type="submit"
          class="h-full p-5 text-4xl text-white hover:bg-highlightColor"
        >
          <ion-icon name="exit-outline" class="pl-3 text-4xl"></ion-icon>
        </button>
      </form>
    </nav>

    {{test}} {% block body %} {% endblock body %}

    <div
      id="timer-container"
      class="absolute bottom-0 right-5 flex w-[20%] min-w-72 max-w-fit items-center"
    >
      <img
        id="timer-image"
        src="{% static 'images/timer.png' %}"
        alt="タイマー画像"
        class=""
      />
      <div
        id="timer-controls"
        class="absolute flex h-[80%] w-full items-center justify-between px-[3%]"
        data-url="{% url 'timer:default' %}"
      >
        <div
          id="timer-display"
          class="flex h-full w-[65%] flex-col items-center justify-center rounded-md bg-white"
        >
          <p
            id="time-edit-error"
            class="fixed mb-20 hidden text-xs text-card-button-red"
          >
            半角数字で入力してください
          </p>
          <p id="time" class="block text-4xl font-medium">{{ default_time }}</p>
          <div
            id="edit-time"
            class="hidden w-11/12 items-center justify-center"
          >
            <input
              name="hours"
              type="text"
              pattern="^[1-9][0-9]*$"
              inputmode="numeric"
              maxlength="2"
              value="00"
              class="input-time w-12 px-0.5 py-1 text-center text-4xl font-medium"
            />
            <p class="text-center text-4xl font-medium">:</p>
            <input
              name="minutes"
              type="text"
              pattern="^[1-9][0-9]*$"
              inputmode="numeric"
              maxlength="2"
              value="00"
              class="input-time w-12 px-0.5 py-1 text-center text-4xl font-medium"
            />
            <p class="text-center text-4xl font-medium">:</p>
            <input
              name="seconds"
              type="text"
              pattern="^[1-9][0-9]*$"
              inputmode="numeric"
              maxlength="2"
              value="00"
              class="input-time w-12 px-0.5 py-1 text-center text-4xl font-medium"
            />
          </div>
        </div>
        <div class="flex h-full w-[30%] flex-col justify-between gap-3 py-[2%]">
          <button
            id="timer-start-btn"
            onclick="startTimer()"
            class="flex h-full w-full items-center justify-center rounded-full bg-white"
          >
            START
          </button>
          <button
            id="timer-stop-btn"
            onclick="stopTimer()"
            class="hidden h-full w-full items-center justify-center rounded-full bg-white"
          >
            STOP
          </button>
          <button
            id="timer-finish-btn"
            onclick="finishTimer()"
            class="flex h-full w-full items-center justify-center rounded-full bg-white"
          >
            FINISH
          </button>
        </div>
      </div>
    </div>

    <div
      id="timer-modal"
      class="fixed left-0 top-0 hidden h-dvh w-dvw items-center justify-center font-kosugiMaru"
    >
      <div
        class="modal-overlay fixed h-full w-full bg-slate-500 opacity-25"
      ></div>
      <div
        class="z-50 flex h-fit w-fit flex-col items-center justify-center rounded border-2 border-card-border bg-card"
      >
        <form
          name="saveTimeForm"
          action="{% url 'timer:save' %}"
          class="flex flex-col items-center justify-center"
          method="post"
        >
          <h2 class="mx-24 mt-12 text-2xl">お疲れさまでした！</h2>
          <p>今回の勉強時間</p>
          <!-- <input id="registered-time" class="mt-1 mb-3 text-xl font-bold text-center" value="00:30:00"></input> -->
          <!-- prettier-ignore -->
          {% csrf_token %}
          {{ timer_modal_form.count_time|add_class:"mt-1 mb-3 text-xl font-bold text-center"|attr:"id:registered-time" }}
          <p>登録しますか？</p>

          <div class="mb-12 flex w-full max-w-sm justify-center gap-8">
            <button
              type="button"
              onclick="saveTime()"
              class="h-8 w-24 rounded bg-card-button-red"
            >
              登録
            </button>
            <button
              type="button"
              onclick="toggleTimerModal()"
              class="h-8 w-24 rounded bg-stone-50"
            >
              キャンセル
            </button>
          </div>
        </form>
      </div>
    </div>

    {% block modal %} {% endblock modal %}

    <script
      type="module"
      src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js"
    ></script>
    <script
      nomodule
      src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.js"
    ></script>

    <script src="{% static 'js/timer.js' %}"></script>
  </body>
</html>
